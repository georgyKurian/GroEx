<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <!-- Group name block start here -->
        <div style="overflow:hidden;">
            <div style="float:left;">
                <h2>#{groupController.currentGroup.group_name}</h2>
            </div>
            <div style="float:left;">
                <h:link value="Settings" outcome="groupSettings"/>
            </div>
             <div style="float:left;">
                <h:link value="Add Bill" outcome="addBill"/>
            </div>
            <div>
                <c:set var="totalExpense" value="#{billController.getTotalExpenseByGroupId(groupController.currentGroup.group_id)}"/>
                <c:set var="noOfMembers" value="#{groupMemberController.getNumberOfMembersByGroupId(groupController.currentGroup.group_id)}"/>
                <c:set var="individualExpense" value="#{totalExpense/noOfMembers}"/>
                <c:set var="contribution" value="#{billController.getTotalExpenseByGroupIdAndUserId(groupController.currentGroup.group_id, userController.currentUser.user_id)}"/>
                <c:set var="balance" value="#{individualExpense-contribution}"/>
                Expense: 
                <c:if test="#{balance lt 0}">
                    <h:outputText value="#{balance*-1}">
                        <f:convertNumber maxFractionDigits="2" groupingUsed="true" currencySymbol="$" maxIntegerDigits="7" type="currency" />
                    </h:outputText>
                </c:if>
                <c:if test="#{balance gt 0}">
                    <h:outputText value="#{balance}">
                        <f:convertNumber maxFractionDigits="2" groupingUsed="true" currencySymbol="$" maxIntegerDigits="7" type="currency" />
                    </h:outputText>
                </c:if>
                
                
            </div>
        </div>
        <!-- Group name block end here -->
        <div style="">
            <h:dataTable value="#{billController.billList}" var="bill" >
                <h:column>
                    <f:facet name="header">Date</f:facet>
                    <h:outputText value="#{bill.bill_date}" >
                        <f:convertDateTime pattern="dd MMM yyyy" />
                    </h:outputText>
                </h:column>
                <h:column>
                    <f:facet name="header">Name</f:facet>
                    #{userController.getUserById(bill.user_id).first_name}
                    #{userController.getUserById(bill.user_id).last_name}
                </h:column>
                <h:column>
                    <f:facet name="header">Description</f:facet>
                    #{bill.bill_description}
                </h:column>
                <h:column>
                    <f:facet name="header">Amount</f:facet>
                    #{bill.bill_amount}
                </h:column>
                <h:column>
                    <f:facet name="header">Type</f:facet>
                    #{bill.bill_type}
                </h:column>
            </h:dataTable>
        </div>
        <!-- Group members block start here -->
        <div style="float:right;">
            <h3>Group Members</h3>
            <h:form>
                <c:forEach var="eachMember" items="#{groupMemberController.getgroupMembersByGroupId(groupController.currentGroup.group_id)}">
                    <div>
                        <div style="float:left;">
                                #{userController.getUserById(eachMember.user_id).first_name}&nbsp;#{userController.getUserById(eachMember.user_id).last_name}
                        </div>
                        <br/>
                    </div>
                </c:forEach>
            </h:form>
        </div>
        <!-- Group members block end here -->
    </h:body>
</html>